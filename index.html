<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Loga-Master: KNTT Edition</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- KaTeX cho hi·ªÉn th·ªã to√°n h·ªçc -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css">
    <script src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/contrib/auto-render.min.js"></script>
    
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;700;800&display=swap" rel="stylesheet">

    <style>
        body { font-family: 'Nunito', sans-serif; }
        
        /* Hi·ªáu ·ª©ng l·∫≠t th·∫ª Flashcard */
        .flip-card {
            background-color: transparent;
            perspective: 1000px;
            cursor: pointer;
            height: 260px;
        }
        .flip-card-inner {
            position: relative;
            width: 100%;
            height: 100%;
            text-align: center;
            transition: transform 0.6s;
            transform-style: preserve-3d;
        }
        .flip-card.flipped .flip-card-inner {
            transform: rotateY(180deg);
        }
        .flip-card-front, .flip-card-back {
            position: absolute;
            width: 100%;
            height: 100%;
            backface-visibility: hidden;
            border-radius: 1rem;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 1rem;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
        }
        .flip-card-front {
            background-color: #ffffff;
            color: #1e293b;
            border: 2px solid #e2e8f0;
        }
        .flip-card-back {
            background-color: #eff6ff;
            color: #1e40af;
            transform: rotateY(180deg);
            border: 2px solid #3b82f6;
        }

        /* Hi·ªáu ·ª©ng Game Gh√©p C·∫∑p */
        .game-card {
            transition: all 0.2s ease;
        }
        .game-card:active { transform: scale(0.95); }
        .selected { border-color: #3b82f6; background-color: #dbeafe; transform: scale(1.02); }
        .matched { visibility: hidden; opacity: 0; transition: opacity 0.5s; }
        .wrong { animation: shake 0.5s; border-color: #ef4444; background-color: #fee2e2; }
        
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            75% { transform: translateX(5px); }
        }

        /* Hi·ªáu ·ª©ng Game Tr·∫Øc Nghi·ªám (ƒêi·ªÅn khuy·∫øt) */
        .quiz-option {
            transition: all 0.2s;
        }
        .quiz-option:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        }
        .quiz-correct {
            background-color: #dcfce7 !important;
            border-color: #22c55e !important;
            color: #15803d !important;
        }
        .quiz-wrong {
            background-color: #fee2e2 !important;
            border-color: #ef4444 !important;
            color: #b91c1c !important;
        }

        /* ·∫®n hi·ªán Tab */
        .tab-content { display: none; }
        .tab-content.active { display: block; animation: fadeIn 0.3s ease-in; }
        .nav-btn.active { border-bottom: 3px solid #3b82f6; color: #2563eb; font-weight: 700; background-color: #eff6ff; }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(5px); }
            to { opacity: 1; transform: translateY(0); }
        }
    </style>
</head>
<body class="bg-slate-100 min-h-screen pb-10">

    <!-- Navbar -->
    <nav class="bg-white shadow-sm sticky top-0 z-50">
        <div class="max-w-5xl mx-auto px-4">
            <div class="flex justify-between items-center h-16">
                <div class="flex items-center gap-2">
                    <div class="w-8 h-8 bg-blue-600 rounded-lg flex items-center justify-center text-white font-bold text-lg shadow-blue-200 shadow-lg">L</div>
                    <span class="font-bold text-xl text-slate-800 hidden sm:inline">Loga-Master <span class="text-xs bg-blue-100 text-blue-800 px-2 py-0.5 rounded-full ml-1">KNTT 11</span></span>
                    <span class="font-bold text-xl text-slate-800 sm:hidden">Loga-Master</span>
                </div>
            </div>
            <!-- Menu Tabs -->
            <div class="flex mt-1 overflow-x-auto no-scrollbar border-t border-slate-100">
                <button onclick="switchTab('learn')" id="btn-learn" class="nav-btn active flex-1 py-3 px-4 text-slate-500 hover:text-blue-600 transition text-sm sm:text-base whitespace-nowrap">
                    üìñ L√Ω Thuy·∫øt
                </button>
                <button onclick="switchTab('game')" id="btn-game" class="nav-btn flex-1 py-3 px-4 text-slate-500 hover:text-blue-600 transition text-sm sm:text-base whitespace-nowrap">
                    üéÆ Game Ph·∫£n X·∫°
                </button>
                <button onclick="switchTab('quiz')" id="btn-quiz" class="nav-btn flex-1 py-3 px-4 text-slate-500 hover:text-blue-600 transition text-sm sm:text-base whitespace-nowrap">
                    ‚úçÔ∏è Luy·ªán T√≠nh To√°n
                </button>
            </div>
        </div>
    </nav>

    <div class="max-w-5xl mx-auto px-4 pt-6">
        
        <!-- TAB 1: H·ªåC T·∫¨P (FLASHCARDS) -->
        <div id="tab-learn" class="tab-content active">
            <div class="mb-6 text-center">
                <h2 class="text-2xl font-bold text-slate-800">Kho t√†ng c√¥ng th·ª©c</h2>
                <p class="text-slate-600 text-sm">Ch·∫°m v√†o th·∫ª ƒë·ªÉ l·∫≠t xem c√¥ng th·ª©c, ƒëi·ªÅu ki·ªán v√† v√≠ d·ª•.</p>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6" id="flashcard-container">
                <!-- Flashcards injected by JS -->
            </div>
        </div>

        <!-- TAB 2: GAME GH√âP C·∫∂P -->
        <div id="tab-game" class="tab-content">
            <div class="flex flex-col md:flex-row justify-between items-center mb-6 gap-4">
                <div>
                    <h2 class="text-2xl font-bold text-slate-800">Gh√©p c·∫∑p c√¥ng th·ª©c</h2>
                    <p class="text-slate-600 text-sm">Ch·ªçn 2 th·∫ª t∆∞∆°ng ƒë∆∞∆°ng ƒë·ªÉ tri·ªát ti√™u ch√∫ng.</p>
                </div>
                <div class="flex gap-3">
                    <div class="bg-white px-4 py-2 rounded-lg shadow-sm border border-slate-200">
                        <span class="text-xs text-slate-400 uppercase font-bold">C√≤n l·∫°i</span>
                        <div class="text-xl font-bold text-blue-600" id="game-pairs">0</div>
                    </div>
                    <button onclick="initGame()" class="bg-indigo-600 hover:bg-indigo-700 text-white px-4 py-2 rounded-lg font-medium shadow-md transition flex items-center">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-1" viewBox="0 0 20 20" fill="currentColor">
                            <path fill-rule="evenodd" d="M4 2a1 1 0 011 1v2.101a7.002 7.002 0 0111.601 2.566 1 1 0 11-1.885.666A5.002 5.002 0 005.999 7H9a1 1 0 010 2H4a1 1 0 01-1-1V3a1 1 0 011-1zm.008 9.057a1 1 0 011.276.61A3.001 3.001 0 0014.001 13H11a1 1 0 110-2h5a1 1 0 011 1v5a1 1 0 11-2 0v-2.101a7.002 7.002 0 01-11.601-2.566 1 1 0 01.61-1.276z" clip-rule="evenodd" />
                        </svg>
                        Ch∆°i l·∫°i
                    </button>
                </div>
            </div>

            <!-- Game Board -->
            <div id="game-board" class="grid grid-cols-2 md:grid-cols-4 gap-3 md:gap-4 select-none">
                <!-- Game cards inserted here -->
            </div>
            
            <!-- Victory Modal for Game -->
            <div id="victory-modal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
                <div class="bg-white rounded-2xl p-8 max-w-sm w-full text-center shadow-2xl transform transition-all scale-100">
                    <div class="w-20 h-20 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-4">
                        <span class="text-4xl">üèÜ</span>
                    </div>
                    <h3 class="text-2xl font-bold text-slate-800 mb-2">Xu·∫•t s·∫Øc!</h3>
                    <p class="text-slate-600 mb-6">B·∫°n ƒë√£ gh√©p ƒë√∫ng t·∫•t c·∫£ c√°c c·∫∑p c√¥ng th·ª©c.</p>
                    <button onclick="document.getElementById('victory-modal').classList.add('hidden'); initGame()" class="w-full bg-blue-600 text-white py-3 rounded-xl font-bold hover:bg-blue-700 transition">
                        Ch∆°i v√°n m·ªõi
                    </button>
                </div>
            </div>
        </div>

        <!-- TAB 3: LUY·ªÜN T√çNH TO√ÅN (QUIZ ƒêI·ªÄN KHUY·∫æT) -->
        <div id="tab-quiz" class="tab-content">
            <div class="max-w-2xl mx-auto">
                <div class="mb-6 text-center">
                    <h2 class="text-2xl font-bold text-slate-800">Luy·ªán t·∫≠p t√≠nh to√°n</h2>
                    <p class="text-slate-600 text-sm">ƒêi·ªÅn s·ªë th√≠ch h·ª£p v√†o ch·ªó tr·ªëng (...) ƒë·ªÉ ho√†n th√†nh ph√©p t√≠nh.</p>
                </div>

                <div class="bg-white rounded-2xl shadow-lg border border-slate-200 overflow-hidden relative min-h-[400px]">
                    <!-- Progress Bar -->
                    <div class="w-full bg-slate-100 h-2">
                        <div id="quiz-progress" class="bg-blue-600 h-2 transition-all duration-300" style="width: 0%"></div>
                    </div>

                    <div id="quiz-content" class="p-8">
                        <div class="flex justify-between items-center mb-8">
                            <span class="text-sm font-bold text-slate-400 uppercase tracking-wide">C√¢u h·ªèi <span id="quiz-current">1</span>/<span id="quiz-total">10</span></span>
                            <span class="px-3 py-1 bg-blue-50 text-blue-700 rounded-full text-sm font-bold" id="quiz-score">ƒêi·ªÉm: 0</span>
                        </div>

                        <!-- Question -->
                        <div class="text-center mb-10">
                            <div class="text-2xl md:text-3xl font-bold text-slate-800 mb-2" id="quiz-question">
                                $$ \log_2 8 = ... $$
                            </div>
                            <p class="text-slate-500 text-sm italic">Ch·ªçn ƒë√°p √°n ƒë√∫ng nh·∫•t</p>
                        </div>

                        <!-- Options -->
                        <div class="grid grid-cols-2 gap-4" id="quiz-options">
                            <!-- Options injected by JS -->
                        </div>
                        
                        <!-- Feedback Message -->
                        <div id="quiz-feedback" class="mt-6 text-center hidden">
                            <p class="text-lg font-bold" id="feedback-text"></p>
                            <button onclick="nextQuestion()" class="mt-4 bg-blue-600 text-white px-6 py-2 rounded-lg hover:bg-blue-700 transition">C√¢u ti·∫øp theo ‚Üí</button>
                        </div>
                    </div>

                    <!-- End Screen -->
                    <div id="quiz-end" class="hidden absolute inset-0 bg-white flex flex-col items-center justify-center p-8 z-10">
                        <div class="text-6xl mb-4">üéØ</div>
                        <h3 class="text-2xl font-bold text-slate-800 mb-2">Ho√†n th√†nh b√†i luy·ªán!</h3>
                        <p class="text-slate-600 mb-6">B·∫°n ƒë√£ tr·∫£ l·ªùi ƒë√∫ng <span id="final-score" class="font-bold text-blue-600"></span> c√¢u h·ªèi.</p>
                        <button onclick="initQuiz()" class="bg-blue-600 text-white px-8 py-3 rounded-xl font-bold hover:bg-blue-700 transition shadow-lg">
                            L√†m l·∫°i b√†i kh√°c
                        </button>
                    </div>
                </div>
            </div>
        </div>

    </div>

    <!-- JAVASCRIPT LOGIC -->
    <script>
        // --- DATA 1: C√îNG TH·ª®C ƒê·∫¶Y ƒê·ª¶ (K√àM ƒêI·ªÄU KI·ªÜN) ---
        // Ph·∫ßn Game s·∫Ω l·∫•y tr·ª±c ti·∫øp d·ªØ li·ªáu t·ª´ ƒë√¢y.
        const textbookData = [
            // 1. ƒê·ªãnh nghƒ©a
            {
                name: "ƒê·ªãnh nghƒ©a Logarit",
                left: "\\log_a b = \\alpha",
                right: "a^\\alpha = b",
                condition: "0 < a \\ne 1, b > 0",
                example: "\\log_2 8 = 3 \\iff 2^3 = 8"
            },
            {
                name: "Logarit th·∫≠p ph√¢n",
                left: "\\log b",
                right: "\\log_{10} b",
                condition: "b > 0",
                example: "\\log 100 = 2"
            },
            {
                name: "Logarit t·ª± nhi√™n",
                left: "\\ln b",
                right: "\\log_{e} b",
                condition: "b > 0",
                example: "\\ln e = 1"
            },
            // 2. T√≠nh ch·∫•t c∆° b·∫£n
            {
                name: "Logarit c·ªßa 1",
                left: "\\log_a 1",
                right: "0",
                condition: "0 < a \\ne 1",
                example: "\\log_{2024} 1 = 0"
            },
            {
                name: "Logarit c·ªßa c∆° s·ªë",
                left: "\\log_a a",
                right: "1",
                condition: "0 < a \\ne 1",
                example: "\\log_5 5 = 1"
            },
            {
                name: "M≈© h√≥a logarit",
                left: "a^{\\log_a b}",
                right: "b",
                condition: "0 < a \\ne 1, b > 0",
                example: "3^{\\log_3 5} = 5"
            },
            {
                name: "Log c·ªßa l≈©y th·ª´a c∆° s·ªë",
                left: "\\log_a a^b",
                right: "b",
                condition: "0 < a \\ne 1",
                example: "\\log_2 2^7 = 7"
            },
            // 3. Quy t·∫Øc t√≠nh
            {
                name: "Logarit c·ªßa t√≠ch",
                left: "\\log_a(xy)",
                right: "\\log_a x + \\log_a y",
                condition: "0 < a \\ne 1; x, y > 0",
                example: "\\log_2(4.8) = 2+3=5"
            },
            {
                name: "Logarit c·ªßa th∆∞∆°ng",
                left: "\\log_a\\left(\\frac{x}{y}\\right)",
                right: "\\log_a x - \\log_a y",
                condition: "0 < a \\ne 1; x, y > 0",
                example: "\\log_3(3/9) = 1-2=-1"
            },
            {
                name: "Logarit c·ªßa l≈©y th·ª´a",
                left: "\\log_a b^\\alpha",
                right: "\\alpha \\log_a b",
                condition: "0 < a \\ne 1, b > 0",
                example: "\\log_2 8^2 = 2.3 = 6"
            },
            // 4. ƒê·ªïi c∆° s·ªë & Bi·∫øn th·ªÉ
            {
                name: "ƒê·ªïi c∆° s·ªë (Th∆∞∆°ng)",
                left: "\\log_a b",
                right: "\\frac{\\log_c b}{\\log_c a}",
                condition: "0 < a,c \\ne 1, b > 0",
                example: "\\log_4 8 = \\frac{\\ln 8}{\\ln 4}"
            },
            {
                name: "ƒê·ªïi c∆° s·ªë (T√≠ch)",
                left: "\\log_a b \\cdot \\log_b c",
                right: "\\log_a c",
                condition: "0 < a,b \\ne 1, c > 0",
                example: "\\log_2 5 \\cdot \\log_5 8 = \\log_2 8"
            },
            {
                name: "Ngh·ªãch ƒë·∫£o",
                left: "\\log_a b",
                right: "\\frac{1}{\\log_b a}",
                condition: "0 < a,b \\ne 1",
                example: "\\log_2 3 = \\frac{1}{\\log_3 2}"
            },
            {
                name: "L≈©y th·ª´a ·ªü c∆° s·ªë",
                left: "\\log_{a^\\alpha} b",
                right: "\\frac{1}{\\alpha} \\log_a b",
                condition: "0 < a \\ne 1, b > 0, \\alpha \\ne 0",
                example: "\\log_{4} 2 = \\frac{1}{2} \\log_2 2 = 0.5"
            }
        ];

        // --- DATA 2: NG√ÇN H√ÄNG C√ÇU H·ªéI T√çNH TO√ÅN (ƒê√É L·ªåC B·ªé PT/TXƒê) ---
        const quizDatabase = [
            // D·∫°ng 1: T√≠nh logarit c∆° b·∫£n (Nh·∫≠n bi·∫øt)
            { q: "\\log_2 16 = ...", options: ["3", "4", "8", "16"], a: 1 }, 
            { q: "\\log_3 1 = ...", options: ["0", "1", "3", "e"], a: 0 },   
            { q: "\\log_5 5 = ...", options: ["0", "1", "5", "25"], a: 1 },  
            { q: "\\log 1000 = ...", options: ["2", "3", "10", "100"], a: 1 }, 
            { q: "\\ln e = ...", options: ["0", "1", "e", "10"], a: 1 },      
            { q: "\\ln e^3 = ...", options: ["1", "3", "e", "3e"], a: 1 },   
            { q: "2^{\\log_2 7} = ...", options: ["2", "7", "14", "49"], a: 1 },
            { q: "\\log_2(1/2) = ...", options: ["1", "-1", "0.5", "2"], a: 1 },
            { q: "\\log_{\\sqrt{2}} 2 = ...", options: ["1", "2", "\\sqrt{2}", "0.5"], a: 1 },
            { q: "\\log_4 2 = ...", options: ["1", "0.5", "2", "-1"], a: 1 },
            { q: "\\log_{0.5} 8 = ...", options: ["-3", "3", "4", "-4"], a: 0 },
            { q: "\\log_9 27 = ...", options: ["1", "1.5", "2", "3"], a: 1 },
            { q: "e^{\\ln 10} = ...", options: ["e", "10", "1", "10e"], a: 1 },
            { q: "\\log_2(2^5) = ...", options: ["2", "5", "10", "32"], a: 1 },
            { q: "\\lg(0.1) = ...", options: ["-1", "1", "0", "0.1"], a: 0 },
            
            // D·∫°ng 2: V·∫≠n d·ª•ng c√¥ng th·ª©c bi·∫øn ƒë·ªïi (Th√¥ng hi·ªÉu)
            { q: "\\log_2 2 + \\log_2 4 = ...", options: ["2", "3", "4", "6"], a: 1 }, 
            { q: "\\log_3 18 - \\log_3 2 = ...", options: ["2", "3", "9", "16"], a: 0 }, 
            { q: "\\log_a \\sqrt{a} = ...", options: ["1", "2", "\\frac{1}{2}", "-1"], a: 2 }, 
            { q: "\\log_2 \\frac{1}{4} = ...", options: ["2", "-2", "4", "0.5"], a: 1 }, 
            { q: "\\log_{\\sqrt{3}} 3 = ...", options: ["1", "2", "3", "\\frac{1}{2}"], a: 1 },
            { q: "\\log_2 3 \\cdot \\log_3 4 = ...", options: ["1", "2", "3", "4"], a: 1 },
            { q: "\\frac{\\ln 8}{\\ln 2} = ...", options: ["2", "3", "4", "\\ln 4"], a: 1 },
            { q: "\\ln(e^2) + \\ln(e^3) = ...", options: ["5", "6", "e^5", "\\ln(e^5)"], a: 0 },
            { q: "\\log_4 8 = ...", options: ["1.5", "2", "2.5", "3"], a: 0 },
            { q: "\\log_{1/2} 4 = ...", options: ["2", "-2", "0.5", "-0.5"], a: 1 },
            { q: "10^{\\log 5} = ...", options: ["5", "10", "50", "100"], a: 0 },
            { q: "\\ln(1/e) = ...", options: ["0", "1", "-1", "e"], a: 2 },
            { q: "\\log_3(\\sqrt[3]{3}) = ...", options: ["1", "3", "1/3", "-3"], a: 2 },
            { q: "a^{\\log_a 5} = ...", options: ["a", "5", "a^5", "\\log 5"], a: 1 },
            { q: "\\log_a 1 + \\log_a a = ...", options: ["0", "1", "a", "2"], a: 1 },
            { q: "\\log_{\\sqrt{a}} a^2 = ...", options: ["2", "4", "1", "0.5"], a: 1 }
        ];

        // --- H√ÄM RENDER TO√ÅN ---
        function renderMath() {
            renderMathInElement(document.body, {
                delimiters: [
                    {left: "$$", right: "$$", display: true},
                    {left: "\\[", right: "\\]", display: true},
                    {left: "$", right: "$", display: false},
                    {left: "\\(", right: "\\)", display: false}
                ],
                throwOnError: false
            });
        }

        function switchTab(tabName) {
            document.querySelectorAll('.tab-content').forEach(el => el.classList.remove('active'));
            document.querySelectorAll('.nav-btn').forEach(el => el.classList.remove('active'));
            
            document.getElementById(`tab-${tabName}`).classList.add('active');
            document.getElementById(`btn-${tabName}`).classList.add('active');

            if (tabName === 'game') initGame();
            if (tabName === 'quiz') initQuiz();
        }

        // --- LOGIC 1: FLASHCARDS ---
        function initFlashcards() {
            const container = document.getElementById('flashcard-container');
            container.innerHTML = '';

            textbookData.forEach((item) => {
                // Hi·ªÉn th·ªã ƒë√∫ng d·∫•u t∆∞∆°ng ƒë∆∞∆°ng cho ƒë·ªãnh nghƒ©a
                const operator = item.name.toLowerCase().includes("ƒë·ªãnh nghƒ©a") ? "\\iff" : "=";
                
                const cardHTML = `
                <div class="flip-card" onclick="this.classList.toggle('flipped')">
                    <div class="flip-card-inner">
                        <div class="flip-card-front">
                            <span class="text-xs font-bold text-slate-400 uppercase mb-2 tracking-wider">${item.name}</span>
                            <div class="text-xl font-bold">$$${item.left} = ?$$</div>
                            <div class="mt-4 text-sm text-blue-500 font-semibold flex items-center">
                                <span class="mr-1">üëÜ</span> Ch·∫°m xem k·∫øt qu·∫£
                            </div>
                        </div>
                        <div class="flip-card-back">
                            <div class="text-sm font-bold text-blue-300 uppercase mb-1">C√¥ng th·ª©c</div>
                            <div class="text-lg font-bold mb-2">$$${item.left} ${operator} ${item.right}$$</div>
                            
                            <div class="bg-red-50 text-red-600 px-3 py-1 rounded-full text-xs font-bold border border-red-100 mb-2">
                                ƒêK: $${item.condition}$
                            </div>

                            <div class="w-full border-t border-blue-200 my-2"></div>
                            <div class="text-xs font-bold text-blue-300 uppercase mb-1">V√≠ d·ª•</div>
                            <div class="text-base">$$${item.example}$$</div>
                        </div>
                    </div>
                </div>`;
                container.innerHTML += cardHTML;
            });
            renderMath();
        }

        // --- LOGIC 2: GAME GH√âP C·∫∂P (CH·ªà C√îNG TH·ª®C L√ù THUY·∫æT) ---
        let firstCard = null;
        let lockBoard = false;
        let pairsLeft = 0;

        function initGame() {
            const board = document.getElementById('game-board');
            const victoryModal = document.getElementById('victory-modal');
            board.innerHTML = '';
            victoryModal.classList.add('hidden');
            firstCard = null;
            lockBoard = false;

            // CH·ªà L·∫§Y C√îNG TH·ª®C L√ù THUY·∫æT
            let playData = [...textbookData].sort(() => 0.5 - Math.random()).slice(0, 8);
            pairsLeft = playData.length;
            document.getElementById('game-pairs').innerText = pairsLeft;

            let cardItems = [];
            playData.forEach((item, index) => {
                cardItems.push({ id: index, content: `$$${item.left}$$`, pairId: index });
                cardItems.push({ id: index, content: `$$${item.right}$$`, pairId: index });
            });

            // X√°o tr·ªôn v·ªã tr√≠ th·∫ª tr√™n b√†n c·ªù
            cardItems.sort(() => 0.5 - Math.random());

            cardItems.forEach(item => {
                const cardEl = document.createElement('div');
                cardEl.className = 'game-card bg-white h-24 md:h-32 rounded-xl shadow-md border-2 border-slate-100 flex items-center justify-center cursor-pointer hover:shadow-lg p-2 overflow-hidden';
                cardEl.dataset.pairId = item.pairId;
                cardEl.innerHTML = `<span class="pointer-events-none text-base md:text-xl">${item.content}</span>`;
                cardEl.addEventListener('click', () => handleCardClick(cardEl));
                board.appendChild(cardEl);
            });

            renderMath();
        }

        function handleCardClick(card) {
            if (lockBoard || card === firstCard || card.classList.contains('matched')) return;
            card.classList.add('selected');
            if (!firstCard) { firstCard = card; return; }
            checkForMatch(firstCard, card);
        }

        function checkForMatch(card1, card2) {
            lockBoard = true;
            const isMatch = card1.dataset.pairId === card2.dataset.pairId;
            if (isMatch) {
                setTimeout(() => {
                    card1.classList.remove('selected'); card2.classList.remove('selected');
                    card1.classList.add('matched'); card2.classList.add('matched');
                    pairsLeft--;
                    document.getElementById('game-pairs').innerText = pairsLeft;
                    firstCard = null; lockBoard = false;
                    if (pairsLeft === 0) setTimeout(() => document.getElementById('victory-modal').classList.remove('hidden'), 500);
                }, 400);
            } else {
                card1.classList.add('wrong'); card2.classList.add('wrong');
                setTimeout(() => {
                    card1.classList.remove('selected', 'wrong'); card2.classList.remove('selected', 'wrong');
                    firstCard = null; lockBoard = false;
                }, 800);
            }
        }

        // --- LOGIC 3: QUIZ (LUY·ªÜN T√çNH TO√ÅN) ---
        let currentQuiz = [];
        let currentQIndex = 0;
        let score = 0;
        let isAnswered = false;

        function initQuiz() {
            // L·∫•y 10 c√¢u h·ªèi ng·∫´u nhi√™n t·ª´ ng√¢n h√†ng 30 c√¢u
            currentQuiz = [...quizDatabase].sort(() => 0.5 - Math.random()).slice(0, 10);
            currentQIndex = 0;
            score = 0;
            document.getElementById('quiz-end').classList.add('hidden');
            document.getElementById('quiz-content').classList.remove('hidden');
            document.getElementById('quiz-total').innerText = currentQuiz.length;
            renderQuestion();
        }

        function renderQuestion() {
            isAnswered = false;
            const qData = currentQuiz[currentQIndex];
            
            document.getElementById('quiz-current').innerText = currentQIndex + 1;
            document.getElementById('quiz-score').innerText = `ƒêi·ªÉm: ${score}`;
            document.getElementById('quiz-progress').style.width = `${((currentQIndex) / currentQuiz.length) * 100}%`;
            
            document.getElementById('quiz-question').innerHTML = `$$ ${qData.q} $$`;
            document.getElementById('quiz-feedback').classList.add('hidden');

            const optionsHTML = qData.options.map((opt, idx) => `
                <button onclick="checkAnswer(${idx})" class="quiz-option w-full bg-white border-2 border-slate-200 rounded-xl py-4 px-2 text-lg font-bold text-slate-700 hover:border-blue-400 focus:outline-none">
                    $$${opt}$$
                </button>
            `).join('');
            
            document.getElementById('quiz-options').innerHTML = optionsHTML;
            renderMath();
        }

        function checkAnswer(selectedIndex) {
            if (isAnswered) return;
            isAnswered = true;

            const qData = currentQuiz[currentQIndex];
            const buttons = document.querySelectorAll('.quiz-option');
            const feedbackText = document.getElementById('feedback-text');
            const feedbackDiv = document.getElementById('quiz-feedback');

            // Highlight ƒë√°p √°n
            if (selectedIndex === qData.a) {
                buttons[selectedIndex].classList.add('quiz-correct');
                feedbackText.innerText = "Ch√≠nh x√°c! üéâ";
                feedbackText.className = "text-lg font-bold text-green-600";
                score++;
            } else {
                buttons[selectedIndex].classList.add('quiz-wrong');
                buttons[qData.a].classList.add('quiz-correct'); // Hi·ªán ƒë√°p √°n ƒë√∫ng
                feedbackText.innerText = "Ti·∫øc qu√°, ch∆∞a ƒë√∫ng r·ªìi! üòÖ";
                feedbackText.className = "text-lg font-bold text-red-500";
            }

            document.getElementById('quiz-score').innerText = `ƒêi·ªÉm: ${score}`;
            feedbackDiv.classList.remove('hidden');
        }

        function nextQuestion() {
            currentQIndex++;
            if (currentQIndex < currentQuiz.length) {
                renderQuestion();
            } else {
                // K·∫øt th√∫c
                document.getElementById('quiz-progress').style.width = '100%';
                document.getElementById('final-score').innerText = `${score}/${currentQuiz.length}`;
                document.getElementById('quiz-content').classList.add('hidden');
                document.getElementById('quiz-end').classList.remove('hidden');
            }
        }

        // Kh·ªüi ƒë·ªông
        document.addEventListener("DOMContentLoaded", () => {
            initFlashcards();
        });

    </script>
</body>
</html>